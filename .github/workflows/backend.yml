name: CI - backend

on:
  push:
    branches:
      - main
      - pipelinegen-setup

jobs:
  build-and-test:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Java
      uses: actions/setup-java@v4
      with:
        java-version: '17' # Or another suitable Java version for your backend
        distribution: 'temurin'
        cache: 'maven'

    - name: Build and Test backend Java unit
      # IMPORTANT: Tests are configured to continue on error, allowing subsequent steps (like Docker build) to run.
      # Review this setting if you prefer to halt the pipeline on test failures.
      working-directory: backend
      run: mvn test
      continue-on-error: true

    - name: Build Docker image for backend
      run: docker build -f backend.Dockerfile -t backend .